# vpa-engine: per-symbol paper trading deployment
#
# Each service runs an independent vpa instance for one ticker symbol.
# Data is isolated per symbol (separate SQLite DBs and journals).
# API keys are shared from .env file.
#
# Quick start:
#   1. Copy .env.example to .env and set your Alpaca keys
#   2. docker compose build
#   3. docker compose run --rm vpa-spy ingest --days 60
#   4. docker compose run --rm vpa-qqq ingest --days 60
#   5. docker compose run --rm vpa-spy ingest --timeframe 1d --days 365
#   6. docker compose run --rm vpa-qqq ingest --timeframe 1d --days 365
#   7. docker compose up -d          # starts live paper trading for all symbols
#   8. docker compose logs -f        # watch signals in real time
#
# Add more symbols:
#   1. Create deploy/config-AAPL.yaml (copy SPY, change symbol + paths)
#   2. Optionally create docs/config/vpa.AAPL.json for VPA param overrides
#   3. Add a new service block below (copy vpa-spy, change config mount)

services:
  vpa-spy:
    build: .
    container_name: vpa-spy
    env_file: .env
    volumes:
      - ./data:/app/data
      - ./deploy/config-SPY.yaml:/app/config.yaml:ro
      - ./docs/config:/app/docs/config:ro
    command: ["paper", "--live"]
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "vpa", "health"]
      interval: 60s
      timeout: 10s
      start_period: 30s
      retries: 3

  vpa-qqq:
    build: .
    container_name: vpa-qqq
    env_file: .env
    volumes:
      - ./data:/app/data
      - ./deploy/config-QQQ.yaml:/app/config.yaml:ro
      - ./docs/config:/app/docs/config:ro
    command: ["paper", "--live"]
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "vpa", "health"]
      interval: 60s
      timeout: 10s
      start_period: 30s
      retries: 3
